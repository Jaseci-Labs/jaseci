\ProvidesPackage{book}
\usepackage{minitoc}
\dominitoc
\usepackage[table]{xcolor}
\definecolor{light-gray}{HTML}{E5E4E2}
\definecolor{light-cyan}{HTML}{FFFEFD}

\usepackage[utf8]{inputenc}
\usepackage{subcaption}
\usepackage[font={footnotesize, it}]{caption}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage[export]{adjustbox}
\usepackage{grffile}
\usepackage{booktabs}
\usepackage{enumitem}
\usepackage{footnote}
\usepackage[toc]{glossaries}
\newglossary[tlg]{technical}{tld}{tdn}{Techinical Terms}
%\makeglossaries
\usepackage{hyperref}
\hypersetup{
    citecolor=black,
    filecolor=black,
    linkcolor=black,
    urlcolor=black,
    hyperindex=true,
    bookmarks=true,
    pdfa,
    colorlinks=true,
    breaklinks=true,
    bookmarksopen=true,
    unicode=true
}

% Set the dimensions of the pages.
\usepackage[margin=1in]{geometry}
\setlength\paperwidth{7.5in}
\setlength\paperheight{9.25in}
\setlength\textwidth{5.2in}
\setlength\textheight{7.2in}


\setlength\parindent{0pt}
\setlength{\parskip}{1em}

% To fix table of content spacing
\usepackage{tocloft}
\raggedbottom

% For front page
\usepackage{pagecolor}
\usepackage{setspace}
\usepackage{ulem}

\graphicspath{{./}{./assets/tex/sci_piece/}{../../examples/CanoniCAI/}}
%Table colors

%----------------------------------- LISTINGS  ------------------------------
\usepackage{listings}

\lstdefinelanguage{jac}
{
    % list of keywords
    keywords={ import, node, ignore, take, entry, activity, exit, spawn, with,
            edge, walker, and, or, if, elif, else, for, with, by, while,
            continue, break, disengage, report, anchor, has, can, true, false,
            context, info, details, try, strict, length, test, type, str,
            int, float, list, dict, bool, digraph, subgraph, test, by, in, to,
            skip, assert, yield
        },
    sensitive=false, % keywords are not case-sensitive
    morecomment=[l]{//}, % l is for line comment
    morecomment=[l]{\#}, % l is for line comment
    morecomment=[s]{/*}{*/}, % s is for start and end delimiter
    morestring=[b]", % defines that strings are enclosed in double quotes
    morestring=[b]',
}

\lstdefinelanguage{shell}
{
    % list of keywords
    keywords={
        },
}

\lstdefinestyle{gram}{
basicstyle=\ttfamily\color{olive},%
breaklines=true,%                                      allow line breaks
moredelim=[s][\color{green!50!black}\ttfamily]{'}{'},% single quotes in green
moredelim=*[s][\color{black}\ttfamily]{options}{\}},%  options in black (until trailing })
commentstyle={\color{gray}\itshape},%                  gray italics for comments
morecomment=[l]{//},%                                  define // comment
emph={%
        STRING%                                            literal strings listed here
    },emphstyle={\color{blue}\ttfamily},%              and formatted in blue
alsoletter={:,|,;},%
morekeywords={:,|,;},%                                 define the special characters
keywordstyle={\color{black}},%                         and format them in black
}

\renewcommand{\lstlistlistingname}{List of \lstlistingname s}% List of Listings -> List of Algorithms

\DeclareCaptionFont{white}{\color{white}\footnotesize\upshape\ttfamily}
% \DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{#1#2#3}}}
\DeclareCaptionFormat{listing}{\colorbox{gray}{\parbox{\dimexpr\linewidth-2\fboxsep\relax}{#1#2#3}}}
\captionsetup[lstlisting]{format=listing,labelfont=white,textfont=white,margin=2pt}
\lstset{ %
    language=jac,                                     % choose the language of the code
    frame=single,	                                % adds a frame around the code
    columns=fullflexible,
    breaklines=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    backgroundcolor=\color{gray!10},
    captionpos=t,
    basicstyle=\upshape\ttfamily,      % the size of the fonts that are used for the code
     numbers=left,                    % where to put the line-numbers; possible values are (none, left, right)
    numbersep=10pt,                   % how far the line-numbers are from the code
    numberstyle=\tiny\color{gray}, % the style that is used for the line-numbers
    keywordstyle=\bfseries\color{green!55!black},
    commentstyle=\itshape\color{purple!70!black},
    identifierstyle=\color{blue!60!black},
    stringstyle=\color{orange},
    xleftmargin=5.8pt,
    xrightmargin=5.8pt,
}

\lstdefinestyle{yaml}{
     basicstyle=\color{blue}\footnotesize,
     rulecolor=\color{black},
     string=[s]{'}{'},
     stringstyle=\color{blue},
     comment=[l]{:},
     commentstyle=\color{black},
     morecomment=[l]{-}
 }

% This version forces listing on single page
% \newcommand{\pycode}[2]{\renewcommand{\lstlistingname}{Python Code}\par\begin{minipage}{\linewidth}\lstinputlisting[label=py:#1, language=Python, caption={#2}]{assets/code/#1}\end{minipage}\par}

% \newcommand{\jaccode}[2]{\renewcommand{\lstlistingname}{Jac Code}\par\begin{minipage}{\linewidth}\lstinputlisting[label=jac:#1, language=jac, caption={#2}]{assets/code/#1}\end{minipage}\par}

\newcommand{\yaml}[2]{\renewcommand{\lstlistingname}{YAML}\par\lstinputlisting[label=YAML:#1, style=yaml, caption={#2}]{assets/code/#1}\par}

\newcommand{\pycode}[2]{\renewcommand{\lstlistingname}{Python Code}\par\lstinputlisting[label=py:#1, language=Python, caption={#2}]{assets/code/#1}\par}

\newcommand{\jaccode}[2]{\renewcommand{\lstlistingname}{Jac Code}\par\lstinputlisting[label=jac:#1, language=jac, caption={#2}]{assets/code/#1}\par}

\newcommand{\gramcode}[2]{\renewcommand{\lstlistingname}{Grammar}\par\lstinputlisting[label=gram:#1, language=shell, style=gram, numbers=left, caption={#2}]{assets/code/#1}\par}

\newcommand{\gramcoderange}[4]{\renewcommand{\lstlistingname}{Grammar}\par\begin{minipage}{\linewidth}\lstinputlisting[label=gram:#1:#3:#4, language=shell, style=gram, numbers=left, caption={#2}, firstline=#3, lastline=#4, firstnumber=#3]{assets/code/#1}\footnotesize{(full grammar in Appendix~\ref{fullgrammar})}\end{minipage}\par}

\newcommand{\shellout}[1]{\par\begin{minipage}{\linewidth}\lstinputlisting[language=shell,numbers=none]{assets/shell/#1}\end{minipage}\par}

%----------------------------------- NERD ALERT BOX  ------------------------------
\usepackage[many]{tcolorbox}
\usepackage{wrapfig}

\newcounter{nerd}
\newtcolorbox[use counter=nerd]
  {nerd}[1][]
  {title=Nerd Alert~\thetcbcounter~\emph{\footnotesize (time to let your eyes glaze over)},
   left=0pt,
   right=0pt,
   fonttitle=\bfseries,
   coltitle=black,
   colframe=orange!40,
   colback=orange!5,
   #1
}

\newcommand{\apispec}[3]{
\begin{tcolorbox}[colback=white!50!white,arc=0pt,outer arc=0pt,colframe=white!5!black,boxrule=0.7pt,boxsep=8pt,left=2pt,
    colbacktitle=orange!5!white,coltitle=black,title={\texttt{\textbf{#1}}}]
    \texttt{args:} \lstinline[basicstyle=\normalsize\ttfamily]{#2}
    \tcblower
    #3
  \end{tcolorbox}
}

% \newcommand{\argspec}[1]{
% \begin{tcolorbox}[colback=white!50!white,arc=0pt,outer arc=0pt,colframe=white!5!black,boxrule=0.7pt,boxsep=8pt,left=2pt,
%     colbacktitle=white!50!white,coltitle=black,title={\texttt{\textbf{parameters}}}]
%     #1
%   \end{tcolorbox}
% }

\newcommand{\argspec}[2]{
\begin{tcolorbox}[enhanced,attach boxed title to top center={yshift=-3mm,yshifttext=-1mm},
    colback=blue!2!white,colframe=blue!75!black,coltitle=black,colbacktitle=green!5!white,
    title=\texttt{#1},fonttitle=\bfseries,
    boxed title style={size=small,colframe=red!50!black},boxrule=0.5pt, ]
    #2
  \end{tcolorbox}
}

%DOT GRAPH BOX
\newcommand{\jacdot}[3]{\begin{wrapfigure}{r}{#2\linewidth}
    \centering
    \includegraphics[width=.98\linewidth, frame]{assets/dot/#1.dot.pdf}
    \caption[]{#3}
    \label{dot:#1}
\end{wrapfigure}
}

%DOT GRAPH BOX without wrapping
\newcommand{\jacdotnw}[3]{\begin{figure}
    \centering
    \includegraphics[width=#2\linewidth, frame]{assets/dot/#1.dot.pdf}
    \caption[]{#3}
    \label{dot:#1}
\end{figure}
}

%Nicer \texttt
\usepackage{color,soul}
\definecolor{Light}{gray}{.90}
\sethlcolor{Light}

% \let\OldTexttt\texttt
% \renewcommand{\texttt}[1]{\OldTexttt{\hl{#1}}}

\usepackage{python}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Pandoc stuff
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage[]{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\PassOptionsToPackage{hyphens}{url} % url is loaded by hyperref
% for adjustwidth environment
\usepackage[strict]{changepage}

% for formal definitions
\usepackage{framed}

% environment derived from framed.sty: see leftbar environment definition
\definecolor{formalshade}{rgb}{0.95,0.95,1}

\renewenvironment{quote}{%
  \def\FrameCommand{%
    \hspace{1pt}%
    {\color{blue}\vrule width 2pt}%
    {\color{formalshade}\vrule width 4pt}%
    \colorbox{formalshade}%
  }%
  \MakeFramed{\advance\hsize-\width\FrameRestore}%
  \noindent\hspace{-4.55pt}% disable indenting first paragraph
  \begin{adjustwidth}{}{7pt}%
  \vspace{2pt}\vspace{2pt}%
}
{%
  \vspace{2pt}\end{adjustwidth}\endMakeFramed%
}
\newcommand{\passthrough}[1]{#1}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\newenvironment{Shaded}{}{}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{#1}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%